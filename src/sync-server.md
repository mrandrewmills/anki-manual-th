# स्व-होस्टेड सिंक सर्वर

उन्नत उपयोगकर्ता जो AnkiWeb का उपयोग नहीं कर सकते या नहीं करना चाहते हैं, वे इसके बजाय एक स्व-होस्टेड सिंक सर्वर का उपयोग कर सकते हैं।

ध्यान देने योग्य बातें:

- यह एक उन्नत सुविधा है, जिसका लक्ष्य उन उपयोगकर्ताओं के लिए है जो नेटवर्किंग और कमांड लाइन से परिचित हैं। यदि आप इसका उपयोग करते हैं, तो उम्मीद है कि आप किसी भी सेटअप/नेटवर्क/फ़ायरवॉल समस्याओं को स्वयं हल कर सकते हैं, और इसका उपयोग पूरी तरह से आपके अपने जोखिम पर है।
- नए क्लाइंट सिंक प्रोटोकॉल में बदलाव पर निर्भर हो सकते हैं, इसलिए यदि आप सर्वर को भी अपडेट किए बिना अपने Anki क्लाइंट को अपडेट करते हैं तो सिंकिंग काम करना बंद कर सकता है।
- तृतीय-पक्ष सिंक सर्वर भी मौजूद हैं। उनके खिलाफ कोई परीक्षण नहीं किया जाता है, और सिंक प्रोटोकॉल बदलने पर उन्हें पकड़ने में समय लगता है, इसलिए उनकी अनुशंसा नहीं की जाती है।
- Anki के अंदर के संदेश "AnkiWeb" शब्द का उपयोग करेंगे, भले ही एक कस्टम सर्वर कॉन्फ़िगर किया गया हो (उदाहरण के लिए "AnkiWeb से कनेक्ट नहीं हो सकता" जब आपका सर्वर डाउन हो)।

## स्थापित करना/चलाना

सर्वर को स्थापित करने और चलाने के विभिन्न तरीके हैं। आप या तो उपयोग कर सकते हैं:

- Anki के डेस्कटॉप संस्करण के साथ बंडल किया गया सिंक सर्वर
- एक अलग न्यूनतम सिंक सर्वर जिसमें Anki की GUI निर्भरताएँ शामिल नहीं हैं। पायथन और रस्ट कार्यान्वयन उपलब्ध हैं।

### एक पैक किए गए बिल्ड से

यह Anki के डेस्कटॉप संस्करण में निर्मित सिंक सर्वर का उपयोग करता है, जो संस्करण 2.1.57+ से है।

cmd.exe सत्र में विंडोज पर:

```
set SYNC_USER1=user:pass
"\Program Files\anki\anki-console" --syncserver
```

या MacOS, Terminal.app में:

```
SYNC_USER1=user:pass /Applications/Anki.app/Contents/MacOS/launcher --syncserver
```

25.07 से पहले के पुराने पैक किए गए बिल्ड के लिए 'launcher' को 'anki' से बदलें।

या लिनक्स:

```
SYNC_USER1=user:pass anki --syncserver
```

### पिप के साथ

डेस्कटॉप Anki की GUI निर्भरताओं को डाउनलोड करने से बचने के लिए, आप PyPI से डाउनलोड किए गए पायथन पैकेज का उपयोग करके एक स्टैंडअलोन Anki सिंक सर्वर चला सकते हैं। सुनिश्चित करें कि आपके पास Python 3.9+ स्थापित है।

```
python3 -m venv ~/syncserver
~/syncserver/bin/pip install anki
SYNC_USER1=user:pass ~/syncserver/bin/python -m anki.syncserver
```

### कार्गो के साथ

Anki 2.1.66+ से, आप वैकल्पिक रूप से नीचे दिए गए कमांड का उपयोग करके स्टैंडअलोन सिंक सर्वर के रस्ट कार्यान्वयन का निर्माण कर सकते हैं। सुनिश्चित करें कि आपके पास Rustup स्थापित है।

```
cargo install --locked --git https://github.com/ankitects/anki.git --tag 25.02.5 anki-sync-server
```

25.02.5 को नवीनतम Anki संस्करण से बदलें।

प्रोटोबफ (प्रोटोक) स्थापित करने की आवश्यकता होगी।

निर्माण के बाद, आप इसे इसके साथ चला सकते हैं:

```
SYNC_USER1=user:pass anki-sync-server
```

### एक स्रोत चेकआउट से

यदि आपने गिटहब से Anki रेपो को क्लोन किया है, तो आप वहां से स्थापित कर सकते हैं:

```
./ninja extract:protoc ftl_repo
cargo install --path rslib/sync
```

### डॉकर के साथ

आप एक उपयोगकर्ता-योगदानित डॉकरफ़ाइल और कुछ निर्देश [यहां](https://github.com/ankitects/anki/tree/main/docs/syncserver) पा सकते हैं।

## एकाधिक उपयोगकर्ता

`SYNC_USER1` पहले उपयोगकर्ता और पासवर्ड को घोषित करता है, और इसे सेट किया जाना चाहिए। यदि आप एकाधिक खाते सेट करना चाहते हैं तो आप वैकल्पिक रूप से `SYNC_USER2`, `SYNC_USER3` आदि घोषित कर सकते हैं।

## हैश किए गए पासवर्ड

उन्नत उपयोगकर्ता सादे पाठ पासवर्ड के बजाय हैश किए गए पासवर्ड का उपयोग करना चाह सकते हैं। यदि आप ऐसा करना चाहते हैं, तो आपको पासवर्ड हैश उत्पन्न करने के लिए एक अलग टूल (जैसे [यह](https://git.sr.ht/~laalsaas/pbkdf2-password-hash)) का उपयोग करने की आवश्यकता होगी। फिर आप `PASSWORDS_HASHED` env var को 1 (या कोई अन्य मान) पर सेट करके सर्वर को हैश किए गए पासवर्ड की अपेक्षा करने के लिए बता सकते हैं।

जब हैश किए गए पासवर्ड का उपयोग किया जाता है, तो SYNC_USER चर username:password_hash प्रारूप में होने की उम्मीद होती है, जहां password_hash PHC प्रारूप में पासवर्ड का एक हैश होता है।

## भंडारण स्थान

सर्वर को आपके संग्रह और मीडिया की एक प्रति एक फ़ोल्डर में संग्रहीत करने की आवश्यकता होती है। डिफ़ॉल्ट रूप से यह ~/.syncserver है; आप `SYNC_BASE` पर्यावरण चर को परिभाषित करके इसे बदल सकते हैं।

- यह आपके सामान्य Anki डेटा फ़ोल्डर के समान स्थान नहीं होना चाहिए, क्योंकि सर्वर और क्लाइंट को अलग-अलग प्रतियां संग्रहीत करनी चाहिए।
- आपको अपने डेटा को सर्वर पर सिंक करना होगा, न कि मैन्युअल रूप से फ़ाइलों को सर्वर फ़ोल्डर में कॉपी करना होगा।

## सार्वजनिक पहुंच

सर्वर एक अनएन्क्रिप्टेड HTTP कनेक्शन पर सुनता है, इसलिए इसे सीधे इंटरनेट पर उजागर करना एक अच्छा विचार नहीं है। आप या तो उपयोग को अपने स्थानीय नेटवर्क तक सीमित करना चाहेंगे, या सर्वर के सामने कुछ प्रकार का एन्क्रिप्शन लगाना चाहेंगे, जैसे एक VPN (टेलस्केल जाहिरा तौर पर आसान है), या एक HTTPS रिवर्स प्रॉक्सी।

आप `SYNC_HOST` और `SYNC_PORT` को सर्वर द्वारा बाइंड किए जाने वाले होस्ट और पोर्ट को बदलने के लिए परिभाषित कर सकते हैं।

## क्लाइंट सेटअप

आपको अपने कंप्यूटर का नेटवर्क आईपी पता निर्धारित करने की आवश्यकता होगी, और फिर अपने प्रत्येक Anki क्लाइंट को पते पर इंगित करना होगा, उदाहरण के लिए `http://192.168.1.200:8080/` जैसा कुछ। यूआरएल को वरीयताओं में कॉन्फ़िगर किया जा सकता है।

यदि आप AnkiMobile का उपयोग कर रहे हैं और अपने स्थानीय नेटवर्क पर सर्वर से कनेक्ट होने में असमर्थ हैं, तो कृपया iOS सेटिंग्स में जाएं, Anki को नीचे के पास ढूंढें, और "Anki को स्थानीय नेटवर्क तक पहुंचने की अनुमति दें" को बंद करें और फिर से चालू करें।

पुराने डेस्कटॉप क्लाइंट के लिए आपको `SYNC_ENDPOINT` और `SYNC_ENDPOINT_MEDIA` को परिभाषित करने की आवश्यकता थी। यदि पुराने क्लाइंट का उपयोग कर रहे हैं, तो आप इसे `http://192.168.1.200:8080/sync/` और `http://192.168.1.200:8080/msync/` क्रमशः रखेंगे। AnkiDroid क्लाइंट 2.16 से पहले दो एंडपॉइंट के लिए अलग कॉन्फ़िगरेशन की आवश्यकता होती है।

## रिवर्स प्रॉक्सी

यदि HTTPS एक्सेस प्रदान करने के लिए रिवर्स प्रॉक्सी का उपयोग कर रहे हैं (उदा। nginx), और एक सबपाथ पर बाइंड कर रहे हैं (उदा। `http://example.com/custom/` -> `http://localhost:8080/`), तो आपको Anki को कॉन्फ़िगर करते समय एक ट्रेलिंग स्लैश शामिल करना सुनिश्चित करना होगा। यदि आप `http://example.com/custom` डालते हैं, तो यह काम नहीं करेगा।

iOS पर, TLS 1.3 समर्थित नहीं है, इसलिए आपके रिवर्स प्रॉक्सी में TLS 1.2 सक्षम होना चाहिए, या आपको "त्रुटि कोड -9836" मिलेगा।

## बड़ी रिक्वेस्ट

अपलोड पर मानक AnkiWeb सीमा डिफ़ॉल्ट रूप से लागू होती है। आप वैकल्पिक रूप से `MAX_SYNC_PAYLOAD_MEGS` को 100 से अधिक पर सेट कर सकते हैं यदि आप सीमा बढ़ाना चाहते हैं। ध्यान रखें कि यदि आप एक रिवर्स प्रॉक्सी का उपयोग कर रहे हैं, तो आपको वहां भी सीमा समायोजित करने की आवश्यकता हो सकती है।

## परिवर्तनों का योगदान

चूंकि यह सर्वर Anki के साथ बंडल किया गया है, इसलिए सादगी एक डिजाइन लक्ष्य है - यह व्यक्तिगत/पारिवारिक उपयोग के लिए लक्षित है, और REST API या बाहरी डेटाबेस जैसी चीजें जोड़ने वाले PRs को इस समय स्वीकार किए जाने की संभावना नहीं है। यदि संदेह है, तो PR पर काम शुरू करने से पहले कृपया संपर्क करें।

यदि आप एक मौजूदा एपीआई समाधान की तलाश कर रहे हैं, तो AnkiConnect ऐड-ऑन आपकी आवश्यकताओं को पूरा कर सकता है।