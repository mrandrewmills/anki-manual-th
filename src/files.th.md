# การจัดการไฟล์และคอลเลกชันของคุณ

<!-- toc -->

## การตรวจสอบคอลเลกชันของคุณ

เป็นความคิดที่ดีที่จะตรวจสอบไฟล์คอลเลกชันของคุณเป็นครั้งคราวเพื่อหาปัญหา คุณสามารถทำได้โดยไปที่เมนู Tools > Check Database (เครื่องมือ > ตรวจสอบฐานข้อมูล) การตรวจสอบฐานข้อมูลจะช่วยให้แน่ใจว่าไฟล์ไม่เสียหาย สร้างโครงสร้างภายในบางส่วนขึ้นใหม่ และปรับปรุงประสิทธิภาพของไฟล์

เมื่อคุณตรวจสอบฐานข้อมูล รายการแท็กของคุณก็จะถูกสร้างขึ้นใหม่ด้วย เมื่อคุณลบสำรับหรือการ์ดแต่ละรายการ Anki จะไม่ปรับปรุงรายการแท็กที่ใช้แล้ว เนื่องจากไม่มีประสิทธิภาพในการทำเช่นนั้น หากคุณต้องการล้างแท็กเก่าออกจากรายการที่ไม่ได้ใช้งานแล้ว การตรวจสอบฐานข้อมูลคือวิธีที่จะทำได้

โปรดทราบว่า Anki จะปรับปรุงประสิทธิภาพคอลเลกชันของคุณโดยอัตโนมัติทุก 2 สัปดาห์ การปรับปรุงประสิทธิภาพนี้ช่วยให้คอลเลกชันทำงานได้ดี แต่จะไม่ตรวจสอบข้อผิดพลาดหรือสร้างรายการแท็กขึ้นใหม่เมื่อปรับปรุงประสิทธิภาพโดยอัตโนมัติ

## ตำแหน่งไฟล์

บน **Windows** Anki เวอร์ชันล่าสุดจะจัดเก็บไฟล์ Anki ของคุณในโฟลเดอร์ appdata คุณสามารถเข้าถึงได้โดยเปิดตัวจัดการไฟล์และพิมพ์ `%APPDATA%\Anki2` ในช่องตำแหน่ง Anki เวอร์ชันเก่าจะจัดเก็บไฟล์ Anki ของคุณในโฟลเดอร์ชื่อ `Anki` ในโฟลเดอร์ `Documents` ของคุณ

บนคอมพิวเตอร์ **Mac** Anki เวอร์ชันล่าสุดจะจัดเก็บไฟล์ทั้งหมดในโฟลเดอร์ `~/Library/Application Support/Anki2` โฟลเดอร์ Library จะถูกซ่อนไว้โดยค่าเริ่มต้น แต่สามารถเปิดเผยได้ใน Finder โดยกดปุ่ม option ค้างไว้ขณะคลิกที่เมนู Go หากคุณใช้ Anki เวอร์ชันเก่า ไฟล์ Anki ของคุณจะอยู่ในโฟลเดอร์ `Documents/Anki` ของคุณ

บน **Linux** Anki เวอร์ชันล่าสุดจะจัดเก็บข้อมูลของคุณใน
`~/.local/share/Anki2` หรือ `$XDG_DATA_HOME/Anki2` หากคุณได้ตั้งค่า
เส้นทางข้อมูลที่กำหนดเอง หากคุณใช้ **Flatpak** ที่สร้างโดยบุคคลที่สาม
ไฟล์ของคุณจะอยู่ใน `~/.var/app/net.ankiweb.Anki/data/Anki2/`
Anki เวอร์ชันเก่าจะจัดเก็บไฟล์ของคุณใน
`~/Documents/Anki` หรือ `~/Anki`

ภายในโฟลเดอร์ Anki การตั้งค่าระดับโปรแกรมและระดับโปรไฟล์
จะถูกจัดเก็บไว้ในไฟล์ชื่อ prefs.db

นอกจากนี้ยังมีโฟลเดอร์แยกต่างหากสำหรับแต่ละโปรไฟล์ โฟลเดอร์ประกอบด้วย:

- บันทึกย่อ, สำรับ, การ์ด และอื่นๆ ของคุณในไฟล์ชื่อ collection.anki2

- ไฟล์เสียงและรูปภาพของคุณในโฟลเดอร์ collection.media

- โฟลเดอร์ backups

- ไฟล์ระบบบางส่วน

คุณไม่ควรคัดลอกหรือย้ายคอลเลกชันของคุณในขณะที่ Anki กำลังเปิดอยู่ การทำเช่นนั้นอาจทำให้คอลเลกชันของคุณเสียหายได้ โปรดอย่าย้ายหรือแก้ไขไฟล์อื่นๆ ในโฟลเดอร์ด้วย

## ตัวเลือกการเริ่มต้น

หากคุณได้ทำการเปลี่ยนแปลงที่ก่อให้เกิดความเสียหายบนคอมพิวเตอร์เครื่องหนึ่ง และมีสำเนาที่ไม่เสียหายบนคอมพิวเตอร์เครื่องอื่น คุณอาจต้องการเริ่ม Anki โดยไม่ซิงค์ เพื่อใช้ตัวเลือกการซิงค์แบบเต็มโดยไม่ต้องดาวน์โหลดการเปลี่ยนแปลงก่อน ในทำนองเดียวกัน หากคุณกำลังประสบปัญหาเกี่ยวกับ Anki คุณอาจต้อง (หรืออาจได้รับคำแนะนำให้) ปิดใช้งานส่วนเสริมชั่วคราวเพื่อดูว่ามีส่วนเสริมใดที่อาจเป็นสาเหตุของปัญหา หากต้องการทำทั้งสองอย่างพร้อมกัน คุณสามารถเปิด Anki ในเซฟโหมดได้โดยกดปุ่ม <kbd>Shift</kbd> ค้างไว้ขณะเริ่ม Anki กด <kbd>Shift</kbd> ค้างไว้จนกว่าข้อความบนหน้าจอจะแจ้งให้คุณทราบว่า Anki ได้เริ่มทำงานในเซฟโหมดแล้ว

เป็นไปได้ที่จะระบุตำแหน่งโฟลเดอร์ที่กำหนดเองในระหว่างการเริ่มต้น นี่เป็นคุณสมบัติขั้นสูงที่มีวัตถุประสงค์หลักเพื่อใช้กับการติดตั้งแบบพกพา และเราขอแนะนำให้คุณใช้ตำแหน่งเริ่มต้นในสถานการณ์ส่วนใหญ่

ไวยากรณ์ในการระบุโฟลเดอร์สำรองมีดังนี้:

    anki -b /path/to/anki/folder

- หากคุณมีหลายโปรไฟล์ คุณสามารถส่ง -p <name> เพื่อโหลดโปรไฟล์ที่เฉพาะเจาะจง
- หากคุณส่ง -p some-fake-name, Anki จะแสดงหน้าจอโปรไฟล์เมื่อเริ่มต้น
  หากไม่มีโปรไฟล์ให้ไว้ โปรไฟล์ที่ใช้ล่าสุดจะถูกโหลด

- หากต้องการเปลี่ยนภาษาของอินเทอร์เฟซ ให้ใช้ -l <iso 639-1 language code> เช่น "-l ja" สำหรับภาษาญี่ปุ่น

หากคุณต้องการใช้ตำแหน่งโฟลเดอร์ที่กำหนดเองเสมอ คุณสามารถแก้ไขทางลัดไปยัง Anki ได้ บน Windows ให้คลิกขวาที่ทางลัด เลือก Properties (คุณสมบัติ) เลือกแท็บ Shortcut (ทางลัด) และเพิ่ม "-b \\path\\to\\data\\folder" หลังเส้นทางไปยังโปรแกรม ซึ่งควรจะทำให้คุณได้บางอย่างเช่น

    "C:\Program Files\Anki\anki.exe" -b "C:\AnkiDataFolder"

คุณยังสามารถใช้เทคนิคนี้กับตัวเลือก -l เพื่อใช้ Anki ในภาษาต่างๆ ได้อย่างง่ายดาย

บน Windows คุณควรใช้เครื่องหมายแบ็กสแลช (\\) ไม่ใช่เครื่องหมายทับ (/)

บน Mac ไม่มีวิธีง่ายๆ ในการเปลี่ยนพฤติกรรมเมื่อคลิกที่ไอคอน Anki แต่สามารถเริ่ม Anki ด้วยโฟลเดอร์ฐานที่กำหนดเองจากเทอร์มินัลได้:

    open /Applications/Anki.app --args -b ~/myankifolder

อีกทางเลือกหนึ่ง คุณสามารถกำหนดตัวแปรสภาพแวดล้อม "ANKI_BASE" ได้
บน Windows คุณสามารถกำหนดตัวแปรสภาพแวดล้อมด้วย:

    set "ANKI_BASE=C:/path/to/AnkiDataFolder"

บน Linux และ macOS คุณสามารถใช้:

    export ANKI_BASE="/path/to/AnkiDataFolder"

## DropBox และการซิงค์ไฟล์

เราไม่แนะนำให้คุณซิงโครไนซ์โฟลเดอร์ Anki ของคุณโดยตรงกับบริการซิงโครไนซ์ของบุคคลที่สาม เนื่องจากอาจนำไปสู่ความเสียหายของฐานข้อมูลเมื่อไฟล์ถูกซิงค์ในขณะที่กำลังใช้งานอยู่

หากคุณต้องการซิงโครไนซ์เฉพาะสื่อของคุณ คุณสามารถเชื่อมโยงโฟลเดอร์ภายนอกเข้ากับบริการต่างๆ เช่น DropBox ได้ โปรดดู [DropboxWiki: Sync Folders Outside Dropbox (archive.org)][dropboxwiki-sync-other] สำหรับข้อมูลเพิ่มเติม

[dropboxwiki-sync-other]: http://web.archive.org/web/20180919153730/http://www.dropboxwiki.com/tips-and-tricks/sync-other-folders

หากคุณต้องการเก็บคอลเลกชันของคุณให้ซิงค์ด้วย ขอแนะนำอย่างยิ่งให้คุณสร้างสคริปต์ที่คัดลอกไฟล์ของคุณจากโฟลเดอร์ที่ซิงค์ไปยังโฟลเดอร์ในเครื่อง เปิด Anki และจากนั้นคัดลอกไฟล์กลับเมื่อ Anki ปิด สิ่งนี้จะช่วยให้แน่ใจว่าไฟล์จะไม่ถูกซิงโครไนซ์ในขณะที่กำลังเปิดอยู่

## ระบบไฟล์เครือข่าย

เราขอแนะนำอย่างยิ่งให้คุณให้ Anki จัดเก็บไฟล์ของคุณบนฮาร์ดดิสก์ในเครื่อง เนื่องจากระบบไฟล์เครือข่ายอาจนำไปสู่ความเสียหายของฐานข้อมูล หากระบบไฟล์เครือข่ายเป็นทางเลือกเดียวของคุณ ขอแนะนำให้ใช้ Tools > Check Database (เครื่องมือ > ตรวจสอบฐานข้อมูล) เป็นประจำเพื่อตรวจจับความเสียหาย

## การเรียกใช้จากแฟลชไดรฟ์

บน Windows Anki สามารถติดตั้งบน USB / แฟลชไดรฟ์และเรียกใช้เป็นแอปพลิเคชันแบบพกพาได้ ตัวอย่างต่อไปนี้สมมติว่าไดรฟ์ USB ของคุณคือไดรฟ์ G

- คัดลอกโฟลเดอร์ \Program Files\Anki ไปยังแฟลชไดรฟ์ เพื่อให้คุณมีโฟลเดอร์เช่น G:\Anki.

- สร้างไฟล์ข้อความชื่อ G:\anki.bat พร้อมข้อความต่อไปนี้:

  g:\anki\anki.exe -b g:\ankidata

หากคุณต้องการป้องกันไม่ให้หน้าต่างพรอมต์คำสั่งสีดำเปิดค้างไว้ คุณสามารถใช้:

    start /b g:\anki\anki.exe -b g:\ankidata

- การดับเบิลคลิกที่ anki.bat ควรจะเริ่ม Anki โดยมีข้อมูลผู้ใช้จัดเก็บอยู่ใน G:\ankidata.

จำเป็นต้องระบุเส้นทางแบบเต็มรวมถึงตัวอักษรไดรฟ์ - หากคุณพยายามใช้ `\anki\anki.exe` แทน คุณจะพบว่าการซิงค์หยุดทำงาน

การซิงค์สื่อกับ AnkiWeb อาจไม่ทำงานหากแฟลชไดรฟ์ของคุณฟอร์แมตเป็น FAT32 โปรดฟอร์แมตไดรฟ์เป็น NTFS เพื่อให้แน่ใจว่าสื่อซิงค์ได้อย่างถูกต้อง

## การสำรองข้อมูล

โปรดดู [ส่วนนี้](./backups.md).

## ฮาร์ดดิสก์ที่ไม่สามารถเข้าถึงได้

หาก Anki ไม่สามารถเขียนไฟล์ใน [โฟลเดอร์ Anki](#file-locations) ได้ ข้อความจะแสดงขึ้นเมื่อเริ่มต้นว่า Anki ไม่สามารถเขียนลงฮาร์ดดิสก์ได้ และ Anki จะปิด หากคุณไม่แน่ใจว่าจะแก้ไขสิทธิ์ได้อย่างไร โปรดติดต่อผู้ที่อยู่ใกล้คุณที่มีความรู้เกี่ยวกับคอมพิวเตอร์และสามารถช่วยเหลือคุณได้

## สิทธิ์ของโฟลเดอร์ Temp

Anki ใช้โฟลเดอร์ชั่วคราวของระบบเพื่อจัดเก็บข้อมูลชั่วคราว หากสิทธิ์ของโฟลเดอร์นี้ถูกเปลี่ยนจากการตั้งค่าเริ่มต้นโดยแอปที่ผิดปกติหรือแอปป้องกันไวรัสที่มีข้อบกพร่อง Anki จะไม่ทำงานอย่างถูกต้อง

หากคุณใช้เครื่อง Windows 7 ขั้นตอนทั่วไปในการแก้ไขปัญหามีดังต่อไปนี้ เนื่องจากค่อนข้างซับซ้อน โปรดสอบถามผู้ที่มีความรู้เกี่ยวกับ Windows หากคุณไม่แน่ใจ

1. คลิกที่แถบเริ่มต้น และพิมพ์ %temp% (รวมเครื่องหมายเปอร์เซ็นต์) จากนั้นกด <kbd>Enter</kbd>

2. เลื่อนขึ้นหนึ่งโฟลเดอร์ และค้นหาโฟลเดอร์ temp คลิกขวาที่โฟลเดอร์นั้น และเลือก Properties (คุณสมบัติ)

3. ในแท็บ security (ความปลอดภัย) คลิกที่ Advanced (ขั้นสูง)

4. คลิกที่แท็บ Owner (เจ้าของ) หากคุณไม่ได้ระบุว่าเป็นเจ้าของ ให้คลิกปุ่มเพื่อรับสิทธิ์การเป็นเจ้าของ

5. ในแท็บ permissions (สิทธิ์) ตรวจสอบให้แน่ใจว่าคุณมีสิทธิ์ควบคุมเต็มรูปแบบ ในการติดตั้ง W7 เริ่มต้น การควบคุมจะถูกสืบทอดมาจาก c:\users\your-username

## คอลเลกชันที่เสียหาย

Anki ใช้รูปแบบไฟล์ที่แข็งแกร่งต่อการขัดข้องของโปรแกรมและคอมพิวเตอร์ แต่ก็ยังเป็นไปได้ที่คอลเลกชันของคุณจะเสียหายหากไฟล์ถูกแก้ไขในขณะที่ Anki เปิดอยู่ จัดเก็บอยู่บนไดรฟ์เครือข่าย หรือเสียหายจากข้อผิดพลาด

เมื่อคุณเรียกใช้ Tools > Check Database (เครื่องมือ > ตรวจสอบฐานข้อมูล) คุณจะได้รับข้อความหาก Anki ตรวจพบว่าไฟล์เสียหาย **วิธีที่ดีที่สุดในการกู้คืนจากสิ่งนี้คือการกู้คืนจากการ [สำรองข้อมูลอัตโนมัติ](#backups) ล่าสุด** แต่หากการสำรองข้อมูลของคุณเก่าเกินไป คุณสามารถลองซ่อมแซมความเสียหายแทนได้

บน Linux ตรวจสอบให้แน่ใจว่าได้ติดตั้ง sqlite3 แล้ว บน Mac ควรจะติดตั้งไว้แล้ว บน Windows ดาวน์โหลด <http://www.sqlite.org/sqlite-3_6_23.zip>

ถัดไป สร้างการสำรองข้อมูลไฟล์ collection.anki2 ของคุณ ในกรณีที่มีบางอย่างผิดพลาดกับขั้นตอนด้านล่าง

### Linux/macOS

เปิดเทอร์มินัล เปลี่ยนไปที่โฟลเดอร์ที่คอลเลกชันของคุณตั้งอยู่ และพิมพ์:

    sqlite3 collection.anki2 .dump > dump.txt

เปิดไฟล์ dump.txt ที่ได้ในโปรแกรมแก้ไขข้อความ และดูที่บรรทัดสุดท้าย หากอ่านว่า "rollback;" ให้เปลี่ยนเป็น "commit;"

จากนั้นเรียกใช้สิ่งต่อไปนี้ในเทอร์มินัล:

    cat dump.txt | sqlite3 temp.file

ตรวจสอบให้แน่ใจว่าคุณใช้ temp.file - อย่าใส่ collection.anki2 ทางด้านขวา มิฉะนั้นไฟล์จะว่างเปล่า เมื่อคุณทำเสร็จแล้ว ให้ดำเนินการตามขั้นตอนสุดท้าย

### Windows

คัดลอกโปรแกรม `sqlite3.exe` และสำรับของคุณไปยังเดสก์ท็อปของคุณ จากนั้นไปที่ **Start > Run** และพิมพ์ `cmd.exe`

หากคุณใช้ Windows เวอร์ชันล่าสุด พรอมต์คำสั่งอาจไม่เริ่มบนเดสก์ท็อปของคุณ หากคุณไม่เห็นเดสก์ท็อปแสดงในพรอมต์คำสั่ง ให้พิมพ์บางอย่างเช่นต่อไปนี้ โดยแทนที่ "administrator" ด้วยชื่อเข้าสู่ระบบของคุณ

    cd C:\Users\Administrator\Desktop

จากนั้นพิมพ์:

    sqlite3 collection.anki2 .dump > dump.txt

เปิดไฟล์ dump.txt ที่ได้ในโปรแกรมแก้ไขข้อความ และดูที่บรรทัดสุดท้าย หากอ่านว่า "rollback;" ให้เปลี่ยนเป็น "commit;"

จากนั้นเรียกใช้สิ่งต่อไปนี้ในเทอร์มินัล:

    type dump.txt | sqlite3 temp.file

ตรวจสอบให้แน่ใจว่าคุณใช้ temp.file - อย่าใส่ collection.anki2 ทางด้านขวา มิฉะนั้นไฟล์จะว่างเปล่า เมื่อคุณทำเสร็จแล้ว ให้ดำเนินการตามขั้นตอนสุดท้าย

### ขั้นตอนสุดท้าย

ตรวจสอบว่าคุณไม่ได้รับข้อความแสดงข้อผิดพลาด และ temp.file ไม่ว่างเปล่า ขั้นตอนนี้จะปรับปรุงประสิทธิภาพของคอลเลกชันในกระบวนการ ดังนั้นจึงเป็นเรื่องปกติที่ไฟล์ใหม่จะมีขนาดเล็กกว่าไฟล์เก่าเล็กน้อย

เมื่อคุณยืนยันว่าไฟล์ไม่ว่างเปล่า:

- เปลี่ยนชื่อไฟล์ collection.anki2 เดิมเป็นชื่ออื่น

- เปลี่ยนชื่อ temp.file เป็น collection.anki2

- ย้าย collection.anki2 กลับไปยังโฟลเดอร์คอลเลกชันของคุณ โดยเขียนทับเวอร์ชันเก่า

- เริ่ม Anki และไปที่ Tools > Check Database (เครื่องมือ > ตรวจสอบฐานข้อมูล) เพื่อให้แน่ใจว่าคอลเลกชันได้รับการกู้คืนสำเร็จแล้ว
