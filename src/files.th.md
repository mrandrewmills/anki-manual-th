# การจัดการไฟล์และคอลเลกชันของคุณ

<!-- toc -->

## การตรวจสอบคอลเลกชันของคุณ

เป็นความคิดที่ดีที่จะตรวจสอบไฟล์คอลเลกชันของคุณเพื่อหาปัญหาเป็นครั้งคราว คุณสามารถทำได้โดยไปที่เมนู Tools>Check Database (เครื่องมือ>ตรวจสอบฐานข้อมูล) การตรวจสอบฐานข้อมูลจะช่วยให้แน่ใจว่าไฟล์ไม่ได้รับความเสียหาย สร้างโครงสร้างภายในบางส่วนขึ้นมาใหม่ และปรับให้ไฟล์มีประสิทธิภาพสูงสุด

เมื่อคุณตรวจสอบฐานข้อมูล รายการแท็กของคุณจะถูกสร้างขึ้นใหม่ด้วย เมื่อคุณลบสำรับไพ่หรือการ์ดแต่ละใบ Anki จะไม่อัปเดตรายการแท็กที่ใช้แล้ว เนื่องจากไม่มีประสิทธิภาพ หากคุณต้องการล้างแท็กเก่าที่ไม่ได้ใช้งานแล้วออกจากรายการ การตรวจสอบฐานข้อมูลคือวิธีที่จะทำ

โปรดทราบว่า Anki จะปรับคอลเลกชันของคุณให้เหมาะสมโดยอัตโนมัติทุกๆ 2 สัปดาห์ การปรับให้เหมาะสมนี้ช่วยให้แน่ใจว่าคอลเลกชันทำงานได้ดี แต่จะไม่ตรวจสอบข้อผิดพลาดหรือสร้างรายการแท็กใหม่เมื่อปรับให้เหมาะสมโดยอัตโนมัติ

<a id="file-locations"></a>

## ข้อมูลผู้ใช้

บน **Windows** Anki เวอร์ชันล่าสุดจะจัดเก็บไฟล์คอลเลกชันของคุณไว้ในโฟลเดอร์ appdata ของคุณ คุณสามารถเข้าถึงได้โดยเปิดตัวจัดการไฟล์ และพิมพ์ `%APPDATA%\Anki2` ในช่องตำแหน่งที่ตั้ง Anki เวอร์ชันเก่าจะจัดเก็บไฟล์ Anki ของคุณไว้ในโฟลเดอร์ชื่อ `Anki` ในโฟลเดอร์ `Documents` ของคุณ

บนคอมพิวเตอร์ **Mac** Anki เวอร์ชันล่าสุดจะจัดเก็บข้อมูลผู้ใช้ทั้งหมดไว้ในโฟลเดอร์ `~/Library/Application Support/Anki2` โฟลเดอร์ Library จะถูกซ่อนไว้ตามค่าเริ่มต้น แต่สามารถเปิดเผยได้ใน Finder โดยกดปุ่ม option ค้างไว้ขณะคลิกที่เมนู Go หากคุณใช้ Anki เวอร์ชันเก่า ไฟล์ Anki ของคุณจะอยู่ในโฟลเดอร์ `Documents/Anki`

บน **Linux** Anki เวอร์ชันล่าสุดจะจัดเก็บข้อมูลผู้ใช้ของคุณไว้ใน `~/.local/share/Anki2` หรือ `$XDG_DATA_HOME/Anki2` หากคุณได้ตั้งค่าเส้นทางข้อมูลที่กำหนดเอง หากคุณใช้บิลด์ **Flatpak** ของบุคคลที่สาม ไฟล์ของคุณจะอยู่ใน `~/.var/app/net.ankiweb.Anki/data/Anki2/` Anki เวอร์ชันเก่าจะจัดเก็บไฟล์ของคุณไว้ใน `~/Documents/Anki` หรือ `~/Anki`

ภายในโฟลเดอร์ Anki การตั้งค่าระดับโปรแกรมและระดับโปรไฟล์จะถูกเก็บไว้ในไฟล์ชื่อ `prefs.db`

นอกจากนี้ยังมีโฟลเดอร์แยกสำหรับแต่ละโปรไฟล์ โฟลเดอร์ประกอบด้วย:

- บันทึกย่อ สำรับไพ่ การ์ด และอื่นๆ ของคุณในไฟล์ชื่อ `collection.anki2`
- ไฟล์เสียงและรูปภาพของคุณในโฟลเดอร์ `collection.media`
- โฟลเดอร์สำรองข้อมูล
- ไฟล์ระบบบางไฟล์

คุณไม่ควรคัดลอกหรือย้ายคอลเลกชันของคุณในขณะที่ Anki เปิดอยู่ การทำเช่นนั้นอาจทำให้คอลเลกชันของคุณเสียหายได้ โปรดอย่าย้ายหรือแก้ไขไฟล์อื่นๆ ในโฟลเดอร์ด้วย

## ไฟล์โปรแกรม

ตัวเรียกใช้งานของ Anki จะถูกติดตั้งในตำแหน่งต่อไปนี้ตามค่าเริ่มต้น:

- Windows: `%LOCALAPPDATA%\Programs\Anki`
- macOS: `/Applications/Anki.app`
- Linux: `/usr/local/share/anki`

เมื่อคุณติดตั้ง/อัปเดต Anki ด้วยตัวเรียกใช้งาน โปรแกรมจะดาวน์โหลดไฟล์สนับสนุนและวางไว้ในตำแหน่งต่อไปนี้:

- Windows: `%LOCALAPPDATA%\AnkiProgramFiles`
- macOS: `~/Library/Application Support/AnkiProgramFiles`
- Linux: `~/.local/share/AnkiProgramFiles`

การลบโฟลเดอร์นั้นจะทำให้ตัวเรียกใช้งานทำงานเหมือนกับการติดตั้งใหม่

`AnkiProgramFiles` ประกอบด้วยไฟล์ทั้งหมดที่จำเป็นในการรัน Anki นอกเหนือจากตัวเรียกใช้งาน คุณสามารถคัดลอกไปยังโฟลเดอร์หรือระบบอื่น และเริ่ม Anki จากตำแหน่งใหม่โดยเปิด `AnkiProgramFiles/.venv/bin/anki` (หรือ `AnkiProgramFiles\.venv\scripts\anki` บน Windows) หากวางไว้ในตำแหน่งมาตรฐานบนคอมพิวเตอร์เครื่องใหม่ ตัวเรียกใช้งานจะสามารถใช้ไฟล์ที่มีอยู่ซ้ำได้ หากไฟล์ถูกคัดลอกโดยรักษาวันที่และเวลาแก้ไขไว้

ดูรายละเอียดเพิ่มเติมในส่วนแฟลชไดรฟ์ด้านล่าง

## ตัวเลือกการเริ่มต้น

หากคุณได้ทำการเปลี่ยนแปลงที่สร้างความเสียหายบนคอมพิวเตอร์เครื่องหนึ่งและมีสำเนาที่ไม่เสียหายในคอมพิวเตอร์อีกเครื่องหนึ่ง คุณอาจต้องการเริ่ม Anki โดยไม่ต้องซิงค์เพื่อใช้ตัวเลือกการซิงค์แบบเต็มโดยไม่ต้องดาวน์โหลดการเปลี่ยนแปลงก่อน ในทำนองเดียวกัน หากคุณกำลังประสบปัญหากับ Anki คุณอาจต้อง (หรืออาจได้รับคำแนะนำให้) ปิดใช้งานส่วนเสริมชั่วคราวเพื่อดูว่ามีส่วนเสริมใดเป็นสาเหตุของปัญหาหรือไม่ ในการทำทั้งสองอย่างนี้พร้อมกัน คุณสามารถเปิด Anki ในเซฟโหมดได้โดยกดปุ่ม <kbd>Shift</kbd> ค้างไว้ขณะเริ่ม Anki กด <kbd>Shift</kbd> ค้างไว้จนกว่าข้อความบนหน้าจอจะแจ้งให้คุณทราบว่า Anki ได้เริ่มทำงานในเซฟโหมดแล้ว

เป็นไปได้ที่จะระบุตำแหน่งโฟลเดอร์ที่กำหนดเองระหว่างการเริ่มต้น นี่เป็นคุณสมบัติขั้นสูงที่มีไว้สำหรับใช้กับการติดตั้งแบบพกพาเป็นหลัก และเราขอแนะนำให้คุณใช้ตำแหน่งเริ่มต้นในสถานการณ์ส่วนใหญ่

ไวยากรณ์ในการระบุโฟลเดอร์อื่นมีดังนี้:

    anki -b /path/to/anki/folder

- หากคุณมีหลายโปรไฟล์ คุณสามารถส่งผ่าน -p <ชื่อ> เพื่อโหลดโปรไฟล์ที่ต้องการได้
- หากคุณส่งผ่าน -p some-fake-name Anki จะแสดงหน้าจอโปรไฟล์เมื่อเริ่มต้น หากไม่มีการระบุโปรไฟล์ โปรไฟล์ที่ใช้ล่าสุดจะถูกโหลด
- หากต้องการเปลี่ยนภาษาของอินเทอร์เฟซ ให้ใช้ -l <รหัสภาษา iso 639-1> เช่น "-l ja" สำหรับภาษาญี่ปุ่น

หากคุณต้องการใช้ตำแหน่งโฟลเดอร์ที่กำหนดเองเสมอ คุณสามารถแก้ไขทางลัดไปยัง Anki ของคุณได้ บน Windows ให้คลิกขวาที่ทางลัด เลือก Properties (คุณสมบัติ) เลือกแท็บ Shortcut (ทางลัด) และเพิ่ม "-b \\path\\to\\data\\folder" ต่อท้ายเส้นทางไปยังโปรแกรม ซึ่งจะทำให้คุณได้ผลลัพธ์ประมาณนี้

    "C:\Program Files\Anki\anki.exe" -b "C:\AnkiDataFolder"

คุณยังสามารถใช้เทคนิคนี้กับตัวเลือก -l เพื่อใช้ Anki ในภาษาต่างๆ ได้อย่างง่ายดาย

บน Windows คุณควรใช้เครื่องหมายแบ็กสแลช (\\) ไม่ใช่เครื่องหมายทับ (/)

บน Mac ไม่มีวิธีง่ายๆ ในการเปลี่ยนพฤติกรรมเมื่อคลิกที่ไอคอน Anki แต่สามารถเริ่ม Anki ด้วยโฟลเดอร์ฐานที่กำหนดเองจากเทอร์มินัลได้:

    open /Applications/Anki.app --args -b ~/myankifolder

อีกทางเลือกหนึ่ง คุณสามารถกำหนดตัวแปรสภาพแวดล้อม "ANKI_BASE" ได้ บน Windows คุณสามารถกำหนดตัวแปรสภาพแวดล้อมด้วย:

    set "ANKI_BASE=C:/path/to/AnkiDataFolder"

บน Linux และ macOS คุณสามารถใช้:

    export ANKI_BASE="/path/to/AnkiDataFolder"

## DropBox และการซิงค์ไฟล์

เราไม่แนะนำให้คุณซิงค์โฟลเดอร์ Anki ของคุณโดยตรงกับบริการซิงโครไนซ์ของบุคคลที่สาม เนื่องจากอาจทำให้ฐานข้อมูลเสียหายได้เมื่อไฟล์ถูกซิงค์ในขณะใช้งาน

หากคุณต้องการซิงโครไนซ์เฉพาะสื่อของคุณ คุณสามารถเชื่อมโยงโฟลเดอร์ภายนอกเข้ากับบริการต่างๆ เช่น DropBox ได้ โปรดดู [DropboxWiki: Sync Folders Outside Dropbox (archive.org)][dropboxwiki-sync-other] สำหรับข้อมูลเพิ่มเติม

[dropboxwiki-sync-other]: http://web.archive.org/web/20180919153730/http://www.dropboxwiki.com/tips-and-tricks/sync-other-folders

หากคุณต้องการให้คอลเลกชันของคุณซิงค์อยู่เสมอ ขอแนะนำอย่างยิ่งให้คุณสร้างสคริปต์ที่คัดลอกไฟล์ของคุณจากโฟลเดอร์ที่ซิงค์ไปยังโฟลเดอร์ในเครื่อง เปิด Anki แล้วคัดลอกไฟล์กลับเมื่อปิด Anki วิธีนี้จะช่วยให้แน่ใจว่าไฟล์จะไม่ถูกซิงโครไนซ์ในขณะที่เปิดอยู่

## ระบบไฟล์เครือข่าย

เราขอแนะนำอย่างยิ่งให้คุณจัดเก็บไฟล์ Anki ของคุณไว้บนฮาร์ดดิสก์ในเครื่อง เนื่องจากระบบไฟล์เครือข่ายอาจทำให้ฐานข้อมูลเสียหายได้ หากระบบไฟล์เครือข่ายเป็นทางเลือกเดียวของคุณ ขอแนะนำให้ใช้ Tools>Check Database (เครื่องมือ>ตรวจสอบฐานข้อมูล) เป็นประจำเพื่อตรวจหาความเสียหาย

## การรันจากแฟลชไดรฟ์

บน Windows สามารถติดตั้ง Anki บนไดรฟ์ USB / แฟลชไดรฟ์ และรันเป็นแอปพลิเคชันแบบพกพาได้ ตัวอย่างต่อไปนี้สมมติว่าไดรฟ์ USB ของคุณคือไดรฟ์ G โปรดตรวจสอบให้แน่ใจว่าคุณได้อ่านส่วนไฟล์โปรแกรมด้านบนก่อน

- คัดลอกโฟลเดอร์ `AnkiProgramFiles` ไปยังแฟลชไดรฟ์ เพื่อให้คุณมีโฟลเดอร์เช่น `G:\AnkiProgramFiles`
- สร้างไฟล์ข้อความชื่อ `G:\anki.bat` พร้อมข้อความต่อไปนี้:

  `start /b G:\AnkiProgramFiles\.venv\scripts\pythonw -c "import aqt; aqt.run()" -b G:\AnkiData`

- การดับเบิลคลิกที่ `anki.bat` ควรจะเริ่ม Anki โดยใช้ข้อมูลผู้ใช้ที่เก็บไว้ใน `G:\AnkiData`

การซิงค์สื่อกับ AnkiWeb อาจไม่ทำงานหากแฟลชไดรฟ์ของคุณถูกฟอร์แมตเป็น FAT32 โปรดฟอร์แมตไดรฟ์เป็น NTFS เพื่อให้แน่ใจว่าสื่อซิงค์อย่างถูกต้อง

## การสำรองข้อมูล

โปรดดู [ส่วนนี้](./backups.md)

## ฮาร์ดดิสก์ที่ไม่สามารถเข้าถึงได้

หาก Anki ไม่สามารถเขียนไฟล์ใน [โฟลเดอร์ Anki](#user-data) ได้ ข้อความจะปรากฏขึ้นเมื่อเริ่มต้นโปรแกรมแจ้งว่า Anki ไม่สามารถเขียนลงบนฮาร์ดดิสก์ได้ และ Anki จะปิดตัวลง หากคุณไม่แน่ใจว่าจะแก้ไขสิทธิ์การเข้าถึงได้อย่างไร โปรดติดต่อผู้ที่มีความรู้เกี่ยวกับคอมพิวเตอร์ในบริเวณใกล้เคียงเพื่อขอความช่วยเหลือ

## สิทธิ์ของโฟลเดอร์ชั่วคราว

Anki ใช้โฟลเดอร์ชั่วคราวของระบบเพื่อเก็บข้อมูลชั่วคราว หากสิทธิ์ของโฟลเดอร์นี้ถูกเปลี่ยนแปลงจากการตั้งค่าเริ่มต้นโดยแอปที่ไม่พึงประสงค์หรือแอปป้องกันไวรัสที่มีข้อบกพร่อง Anki จะทำงานไม่ถูกต้อง

หากคุณใช้เครื่อง Windows 7 ขั้นตอนทั่วไปในการแก้ไขปัญหามีดังต่อไปนี้ เนื่องจากค่อนข้างซับซ้อน โปรดสอบถามผู้ที่มีความรู้เกี่ยวกับ Windows หากคุณไม่แน่ใจ

1.  คลิกที่แถบเริ่มต้น และพิมพ์ %temp% (รวมเครื่องหมายเปอร์เซ็นต์ด้วย) จากนั้นกด <kbd>Enter</kbd>
2.  ไปที่โฟลเดอร์ด้านบนหนึ่งระดับ และค้นหาโฟลเดอร์ temp คลิกขวาที่โฟลเดอร์นั้น และเลือก Properties (คุณสมบัติ)
3.  ในแท็บ Security (ความปลอดภัย) คลิกที่ Advanced (ขั้นสูง)
4.  คลิกที่แท็บ Owner (เจ้าของ) หากคุณไม่ได้ถูกระบุว่าเป็นเจ้าของ ให้คลิกปุ่มเพื่อเข้าครอบครองสิทธิ์
5.  ในแท็บ Permissions (สิทธิ์) ตรวจสอบให้แน่ใจว่าคุณมีสิทธิ์ควบคุมเต็มรูปแบบ ในการติดตั้ง W7 เริ่มต้น สิทธิ์ควบคุมจะถูกสืบทอดมาจาก c:\users\your-username

## คอลเลกชันที่เสียหาย

Anki ใช้รูปแบบไฟล์ที่ทนทานต่อการขัดข้องของโปรแกรมและคอมพิวเตอร์ แต่ก็ยังเป็นไปได้ที่คอลเลกชันของคุณจะเสียหายหากไฟล์ถูกแก้ไขในขณะที่ Anki เปิดอยู่ จัดเก็บไว้ในไดรฟ์เครือข่าย หรือเสียหายจากข้อบกพร่อง

เมื่อคุณเรียกใช้ Tools>Check Database (เครื่องมือ>ตรวจสอบฐานข้อมูล) คุณจะได้รับข้อความหาก Anki ตรวจพบว่าไฟล์ได้รับความเสียหาย **วิธีที่ดีที่สุดในการกู้คืนจากปัญหานี้คือการกู้คืนจาก [การสำรองข้อมูลอัตโนมัติล่าสุด](#backups)** แต่ถ้าข้อมูลสำรองของคุณเก่าเกินไป คุณสามารถพยายามซ่อมแซมความเสียหายแทนได้

บน Linux ตรวจสอบให้แน่ใจว่าได้ติดตั้ง sqlite3 แล้ว บน Mac ควรจะติดตั้งไว้แล้ว บน Windows ให้ดาวน์โหลด <http://www.sqlite.org/sqlite-3_6_23.zip>

ต่อไป ให้สร้างข้อมูลสำรองของไฟล์ collection.anki2 ของคุณ ในกรณีที่เกิดข้อผิดพลาดกับขั้นตอนด้านล่าง

### Linux/macOS

เปิดเทอร์มินัล เปลี่ยนไปยังโฟลเดอร์ที่คอลเลกชันของคุณอยู่ และพิมพ์:

    sqlite3 collection.anki2 .dump > dump.txt

เปิดไฟล์ dump.txt ที่ได้ในโปรแกรมแก้ไขข้อความ และดูที่บรรทัดสุดท้าย หากเขียนว่า "rollback;" ให้เปลี่ยนเป็น "commit;"

จากนั้นรันคำสั่งต่อไปนี้ในเทอร์มินัล:

    cat dump.txt | sqlite3 temp.file

ตรวจสอบให้แน่ใจว่าคุณใช้ temp.file - อย่าใส่ collection.anki2 ทางด้านขวา มิฉะนั้นไฟล์จะว่างเปล่า เมื่อคุณทำเสร็จแล้ว ให้ไปยังขั้นตอนสุดท้าย

### Windows

คัดลอกโปรแกรม `sqlite3.exe` และสำรับไพ่ของคุณไปยังเดสก์ท็อป จากนั้นไปที่ **Start>Run** (เริ่ม>เรียกใช้) และพิมพ์ `cmd.exe`

หากคุณใช้ Windows เวอร์ชันล่าสุด พรอมต์คำสั่งอาจไม่เริ่มทำงานบนเดสก์ท็อปของคุณ หากคุณไม่เห็นเดสก์ท็อปแสดงในพรอมต์คำสั่ง ให้พิมพ์ข้อความคล้ายกับต่อไปนี้ โดยแทนที่ "administrator" ด้วยชื่อล็อกอินของคุณ

    cd C:\Users\Administrator\Desktop

จากนั้นพิมพ์:

    sqlite3 collection.anki2 .dump > dump.txt

เปิดไฟล์ dump.txt ที่ได้ในโปรแกรมแก้ไขข้อความ และดูที่บรรทัดสุดท้าย หากเขียนว่า "rollback;" ให้เปลี่ยนเป็น "commit;"

จากนั้นรันคำสั่งต่อไปนี้ในเทอร์มินัล:

    type dump.txt | sqlite3 temp.file

ตรวจสอบให้แน่ใจว่าคุณใช้ temp.file - อย่าใส่ collection.anki2 ทางด้านขวา มิฉะนั้นไฟล์จะว่างเปล่า เมื่อคุณทำเสร็จแล้ว ให้ไปยังขั้นตอนสุดท้าย

### ขั้นตอนสุดท้าย

ตรวจสอบว่าคุณไม่ได้รับข้อความแสดงข้อผิดพลาด และไฟล์ temp.file ไม่ว่างเปล่า กระบวนการนี้จะปรับคอลเลกชันให้เหมาะสมในระหว่างดำเนินการ ดังนั้นจึงเป็นเรื่องปกติที่ไฟล์ใหม่จะมีขนาดเล็กกว่าไฟล์เก่าเล็กน้อย

เมื่อคุณยืนยันแล้วว่าไฟล์ไม่ว่างเปล่า:

- เปลี่ยนชื่อไฟล์ collection.anki2 เดิมเป็นชื่ออื่น
- เปลี่ยนชื่อ temp.file เป็น collection.anki2
- ย้าย collection.anki2 กลับไปที่โฟลเดอร์คอลเลกชันของคุณ โดยเขียนทับเวอร์ชันเก่า
- เริ่ม Anki และไปที่ Tools>Check Database (เครื่องมือ>ตรวจสอบฐานข้อมูล) เพื่อให้แน่ใจว่าคอลเลกชันได้รับการกู้คืนเรียบร้อยแล้ว
